<template>
    <div class="app-container">
        <div class="left-side">
            <div class="navigation">
              <a href="#" class="nav-link icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home" viewBox="0 0 24 24">
                  <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                  <path d="M9 22V12h6v10"/>
                </svg>
              </a>
              <a href="#" class="nav-link icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-square">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
              </a>
              <a href="#" class="nav-link icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone-call" viewBox="0 0 24 24">
                  <path d="M15.05 5A5 5 0 0119 8.95M15.05 1A9 9 0 0123 8.94m-1 7.98v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/>
                </svg>
              </a>
              <a href="#" class="nav-link icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-hard-drive">
                  <line x1="22" y1="12" x2="2" y2="12"/>
                  <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/>
                  <line x1="6" y1="16" x2="6.01" y2="16"/>
                  <line x1="10" y1="16" x2="10.01" y2="16"/>
                </svg>
              </a>
              <a  class="nav-link icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
              </a>
               <a href="#" class="nav-link icon">
                 <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder" viewBox="0 0 24 24">
                   <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>
                 </svg>
              </a>
              <a href="#" class="nav-link icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-settings" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                </svg>
              </a>
            </div>
         
        </div>
       <div class="right-side">
        <div class="header">
            <div class="app-name">Socially</div>
            
            <form class="search">
                <input
                  type="text"
                  class="search__field"
                  placeholder="Search....."
                />
                <button class="btn search__btn">
                  <svg class="search__icon">
                    <use href="img/icons.svg#icon-search"></use>
                  </svg>
                  <span>Search</span>
                </button>
              </form>
            <div class="user-settings">
                 <amplify-s3-image :img-key="user.profilePicUrl" />
            <img class="user-img" :src="user.profilePicUrl" alt="profile-picture">
             <div class="user-name">{{user.username}}</div>
             <svg viewBox="0 0 492 492" fill="currentColor">
              <path d="M484.13 124.99l-16.11-16.23a26.72 26.72 0 00-19.04-7.86c-7.2 0-13.96 2.79-19.03 7.86L246.1 292.6 62.06 108.55c-5.07-5.06-11.82-7.85-19.03-7.85s-13.97 2.79-19.04 7.85L7.87 124.68a26.94 26.94 0 000 38.06l219.14 219.93c5.06 5.06 11.81 8.63 19.08 8.63h.09c7.2 0 13.96-3.57 19.02-8.63l218.93-219.33A27.18 27.18 0 00492 144.1c0-7.2-2.8-14.06-7.87-19.12z"></path>
             </svg>
             <button class="create-post" @click="showCreate">
                 <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 488 488" xml:space="preserve"><path d="M484.26 157.654L381.968 75.239c-3.6-2.901-8.699-3.001-12.299-.2L206.983 198.661c-3.6 2.701-4.9 7.501-3.2 11.702 33.897 83.115 37.697 129.123 14.199 184.633H9.999c-5.5 0-9.999 4.501-9.999 10.002S4.5 415 9.999 415H225.781c.2 0 .4-.1.6-.1.1 0 .2 0 .3-.1.2 0 .5-.1.7-.2.1 0 .2-.1.3-.1h.1c.1 0 .2-.1.3-.1.1 0 .2-.1.3-.1s.2-.1.3-.1c.1 0 .1-.1.2-.1 0 0 .1 0 .1-.1.1 0 .1-.1.2-.1.1-.1.2-.1.3-.2.1-.1.2-.1.3-.2.1 0 .2-.1.2-.2.1 0 .1-.1.2-.1 0 0 .1 0 .1-.1 3.2-2.3 6.299-4.501 9.299-6.601 41.997-30.005 62.995-45.008 176.485-35.206 4.7.4 8.999-2.5 10.399-7.001l61.095-196.035c1.2-3.802-.1-8.103-3.299-10.603zm-74.494 193.135c-77.893-6.201-113.99 0-142.888 14.503l62.795-83.615c4.4 1.9 9.199 3.101 14.199 3.401h1.9c9.899 0 19.198-3.601 26.598-10.302 8.099-7.401 12.799-17.603 13.299-28.805 1-22.704-16.299-42.107-38.497-43.108-10.799-.5-21.098 3.301-29.198 10.602-8.099 7.401-12.799 17.503-13.299 28.505-.5 10.302 3.1 20.004 9.199 27.605l-62.795 83.515c1.8-11.702 2.4-23.404 1.8-35.506-1.5-29.805-9.999-63.211-27.598-107.619l150.287-114.32 90.892 73.313-56.694 181.831zm-85.093-108.02c.3-5.601 2.7-10.802 6.799-14.603 3.9-3.501 8.699-5.401 13.799-5.401h.9c11.299.5 19.998 10.502 19.498 22.204-.3 5.901-2.7 11.202-6.799 14.903-3.8 3.501-8.799 5.301-13.999 5.101-4.3-.1-8.199-1.6-11.399-4.001-.1-.1-.3-.2-.4-.4-.1-.1-.2-.1-.3-.2-5.199-4.1-8.499-10.601-8.099-17.603z"/></svg>
             </button>
            </div>
           </div>
           <div class="middle">
 <div class="main-content">
     <div v-for="post in posts" :key="post.id">
<div class="post">
               <a href="#" class="name-tag">{{post.user.username}}</a>
               <div class="author-img__wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check">
                 <path d="M20 6L9 17l-5-5" />
                </svg>
                <img class="author-img" :src="post.user.profilePicUrl" />
               </div> 
                <img class="img" :src="post.postImageUrl" alt="Post Image">
             </div> 

     </div>
             
        
           </div>
           <div v-if="show">
<create :userId="user.id"/>
           </div>
           
           </div>
          
       </div>
        </div>
</template>

<script>
import { API } from 'aws-amplify';
import {getUser} from '../src/graphql/queries';
import create from './create.vue';
import {onCreatePost} from '../src/graphql/subscriptions';
import { listPosts} from '../src/graphql/queries';
    export default {
  components: { create },
  created(){
  this.getPosts();
  this.subscribe();
 },

        data(){
            return {
                user:Object,
                show:false,
                posts:[]
            }
        },
        //Receiving parameters in Home component
mounted() {
    console.log('Params: ', this.$route.params);
    this.getUserDetails(this.$route.params.id);
   
       
},
methods:{
    async getUserDetails(userId){

         const user =  await API.graphql({
         query:getUser,
         variables:{id: userId}
       });

       this.user =user.data.getUser;

console.log(this.user);
    },
    showCreate(e){
     this.show = !this.show;
    },
     async getPosts(){
       const posts = await API.graphql({
         query:listPosts
       });
       this.posts = posts.data.listPosts.items;
       console.log("this is the post"+ posts.data.listPosts.items[0].user.profilePicUrl);
     },
     subscribe(){
       API.graphql({query: onCreatePost})
       .subscribe({
         next:(eventData) =>{
           let post = eventData.value.data.onCreatePost;

           if(this.posts.some(item => item.postText === post.postText)) return; //remove duplicates
           this.posts = [...this.posts,post];

         }
       });
     }
}
    }
</script>

<style lang="scss" scoped>
.middle{
    display: flex;
    justify-content: space-between;
    overflow-y: scroll;

}
.create-post{
    background-image: var( --gradient);
    padding: 10px;
    margin-left: 5px;
    border-radius: 100%;
    border: none;

    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
 
svg{
width: 30px;
height: 30px;

fill: white;
}
}
</style>